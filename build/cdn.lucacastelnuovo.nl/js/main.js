"use strict";!function(t){t.fn.tablesorter=function(){var e=this;return this.find("th").click(function(){var a=t(this).index(),n=t(this).hasClass("sort_asc");e.tablesortby(a,n)}),this},t.fn.tablesortby=function(e,a){function n(a){var n=t(a).find("td:nth-child("+(e+1)+")"),s=n.attr("data-sort")||n.text();return s==parseInt(s)?parseInt(s):s}var s=this.find("tbody tr");s.sort(function(t,e){var s=n(t),r=n(e);return(s>r?1:s==r?0:-1)*(a?1:-1)}),this.find("th").removeClass("sort_asc sort_desc"),t(this).find("thead th:nth-child("+(e+1)+")").addClass(a?"sort_desc":"sort_asc");for(var r=0;r<s.length;r++)this.append(s[r]);return this.settablesortmarkers(),this},t.fn.retablesort=function(){var t=this.find("thead th.sort_asc, thead th.sort_desc");return t.length&&this.tablesortby(t.index(),t.hasClass("sort_desc")),this},t.fn.settablesortmarkers=function(){return this.find("thead th span.indicator").remove(),this.find("thead th.sort_asc").append('<span class="indicator">&darr;<span>'),this.find("thead th.sort_desc").append('<span class="indicator">&uarr;<span>'),this}}(jQuery),$(function(){function t(t){var s=decodeURIComponent(window.location.hash.substr(1));if(t.size>o){var i=a(t,s);return $("#upload_progress").append(i),window.setTimeout(function(){i.fadeOut()},5e3),!1}var d=e(t,s);$("#upload_progress").append(d);var p=new FormData;p.append("file_data",t),p.append("file",s),p.append("xsrf",r),p.append("do","upload");var l=new XMLHttpRequest;l.open("POST","?"),l.onload=function(){d.remove(),n()},l.upload.onprogress=function(t){t.lengthComputable&&d.find(".progress").css("width",(t.loaded/t.total*100|0)+"%")},l.send(p)}function e(t,e){return $row=$("<div/>").append($('<span class="fileuploadname" />').text((e?e+"/":"")+t.name)).append($('<div class="progress_track"><div class="progress"></div></div>')).append($('<span class="size" />').text(s(t.size)))}function a(t,e){return $row=$('<div class="error" />').append($('<span class="fileuploadname" />').text("Error: "+(e?e+"/":"")+t.name)).append($("<span/>").html(" file size - <b>"+s(t.size)+"</b> exceeds max upload size of <b>"+s(o)+"</b>"))}function n(){var t=window.location.hash.substr(1);$.get("?do=list&file="+t,function(e){var a,n,r;i.empty(),$("#breadcrumb").empty().html((a=t,n="",r=$("<div/>").append($("<a href=#>Home</a></div>")),$.each(a.split("/"),function(t,e){if(e){var a=decodeURIComponent(e);r.append($("<span/>").text(" â–¸ ")).append($("<a/>").attr("href","#"+n+e).text(a)),n+=e+"/"}}),r)),e.success?($.each(e.results,function(t,e){i.append(function(t){var e=$('<a class="name" />').attr("href",t.is_dir?"#"+encodeURIComponent(t.path):"./"+encodeURIComponent(t.path)).text(t.name);t.is_dir,0;var a=$("<a/>").attr("href","?do=download&file="+encodeURIComponent(t.path)).addClass("download").text("download"),n=$('<a href="#" />').attr("data-file",t.path).addClass("delete").text("delete"),r=[];t.is_readable&&r.push("read");t.is_writable&&r.push("write");t.is_executable&&r.push("exec");return $("<tr />").addClass(t.is_dir?"is_dir":"").append($('<td class="first" />').append(e)).append($("<td/>").attr("data-sort",t.is_dir?-1:t.size).html($('<span class="size" />').text(s(t.size)))).append($("<td/>").attr("data-sort",t.mtime).text((o=t.mtime,i=new Date(1e3*o),[["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i.getMonth()]," ",i.getDate(),", ",i.getFullYear()," ",i.getHours()%12||12,":",(i.getMinutes()<10?"0":"")+i.getMinutes()," ",i.getHours()>=12?"PM":"AM"].join("")))).append($("<td/>").text(r.join("+"))).append($("<td/>").append(a).append(t.is_deleteable?n:""));var o,i}(e))}),!e.results.length&&i.append('<tr><td class="empty" colspan=5>This folder is empty</td></tr>'),e.is_writable?$("body").removeClass("no_write"):$("body").addClass("no_write")):console.warn(e.error.msg),$("#table").retablesort()},"json")}function s(t){for(var e=0;t>=1e3;e++,t/=1024);var a=Math.round(10*t);return e?[parseInt(a/10),".",a%10," ",["bytes","KB","MB","GB","TB","PB","EB"][e]].join(""):t+" bytes"}var r=(document.cookie.match("(^|; )_sfm_xsrf=([^;]*)")||0)[2],o=134217728,i=$("#list");$(window).on("hashchange",n).trigger("hashchange"),$("#table").tablesorter(),$("#table").on("click",".delete",function(){return $.post("",{do:"delete",file:$(this).attr("data-file"),xsrf:r},function(){n()},"json"),!1}),$("#mkdir").submit(function(t){var e=decodeURIComponent(window.location.hash.substr(1)),a=$(this).find("[name=name]");return t.preventDefault(),a.val().length&&$.post("?",{do:"mkdir",name:a.val(),xsrf:r,file:e},function(){n()},"json"),a.val(""),!1}),$("#file_drop_target").on("dragover",function(){return $(this).addClass("drag_over"),!1}).on("dragend",function(){return $(this).removeClass("drag_over"),!1}).on("drop",function(e){e.preventDefault();var a=e.originalEvent.dataTransfer.files;$.each(a,function(e,a){t(a)}),$(this).removeClass("drag_over")}),$("input[type=file]").change(function(e){e.preventDefault(),$.each(this.files,function(e,a){t(a)})})});