"use strict";!function(o){o.fn.tablesorter=function(){var a=this;return this.find("th").click(function(){var t=o(this).index(),e=o(this).hasClass("sort_asc");a.tablesortby(t,e)}),this},o.fn.tablesortby=function(n,s){function r(t){var e=o(t).find("td:nth-child("+(n+1)+")"),a=e.attr("data-sort")||e.text();return a==parseInt(a)?parseInt(a):a}var t=this.find("tbody tr");t.sort(function(t,e){var a=r(t),n=r(e);return(n<a?1:a==n?0:-1)*(s?1:-1)}),this.find("th").removeClass("sort_asc sort_desc"),o(this).find("thead th:nth-child("+(n+1)+")").addClass(s?"sort_desc":"sort_asc");for(var e=0;e<t.length;e++)this.append(t[e]);return this.settablesortmarkers(),this},o.fn.retablesort=function(){var t=this.find("thead th.sort_asc, thead th.sort_desc");return t.length&&this.tablesortby(t.index(),t.hasClass("sort_desc")),this},o.fn.settablesortmarkers=function(){return this.find("thead th span.indicator").remove(),this.find("thead th.sort_asc").append('<span class="indicator">&darr;<span>'),this.find("thead th.sort_desc").append('<span class="indicator">&uarr;<span>'),this}}(jQuery),$(function(){function a(t){var e,a,n=decodeURIComponent(window.location.hash.substr(1));if(t.size>u){var s=(e=t,a=n,$row=$('<div class="error" />').append($('<span class="fileuploadname" />').text("Error: "+(a?a+"/":"")+e.name)).append($("<span/>").html(" file size - <b>"+c(e.size)+"</b> exceeds max upload size of <b>"+c(u)+"</b>")));return $("#upload_progress").append(s),window.setTimeout(function(){s.fadeOut()},5e3),!1}var r,o,i=(r=t,o=n,$row=$("<div/>").append($('<span class="fileuploadname" />').text((o?o+"/":"")+r.name)).append($('<div class="progress_track"><div class="progress"></div></div>')).append($('<span class="size" />').text(c(r.size))));$("#upload_progress").append(i);var d=new FormData;d.append("file_data",t),d.append("file",n),d.append("xsrf",h),d.append("do","upload");var p=new XMLHttpRequest;p.open("POST","?"),p.onload=function(){i.remove(),l()},p.upload.onprogress=function(t){t.lengthComputable&&i.find(".progress").css("width",(t.loaded/t.total*100|0)+"%")},p.send(d)}function l(){var a=window.location.hash.substr(1);$.get("?do=list&file="+a,function(t){var e,n,s;r.empty(),$("#breadcrumb").empty().html((e=a,n="",s=$("<div/>").append($("<a href=#>Home</a></div>")),$.each(e.split("/"),function(t,e){if(e){var a=decodeURIComponent(e);s.append($("<span/>").text(" â–¸ ")).append($("<a/>").attr("href","#"+n+e).text(a)),n+=e+"/"}}),s)),t.success?($.each(t.results,function(t,e){r.append(function(t){var e=$('<a class="name" />').attr("href",t.is_dir?"#"+encodeURIComponent(t.path):"./"+encodeURIComponent(t.path)).text(t.name);t.is_dir,0;var a=$("<a/>").attr("href","?do=download&file="+encodeURIComponent(t.path)).addClass("download").text("download"),n=$('<a href="#" />').attr("data-file",t.path).addClass("delete").text("delete"),s=[];t.is_readable&&s.push("read");t.is_writable&&s.push("write");t.is_executable&&s.push("exec");return $("<tr />").addClass(t.is_dir?"is_dir":"").append($('<td class="first" />').append(e)).append($("<td/>").attr("data-sort",t.is_dir?-1:t.size).html($('<span class="size" />').text(c(t.size)))).append($("<td/>").attr("data-sort",t.mtime).text((r=t.mtime,o=new Date(1e3*r),[["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()]," ",o.getDate(),", ",o.getFullYear()," ",o.getHours()%12||12,":",(o.getMinutes()<10?"0":"")+o.getMinutes()," ",12<=o.getHours()?"PM":"AM"].join("")))).append($("<td/>").text(s.join("+"))).append($("<td/>").append(a).append(t.is_deleteable?n:""));var r,o}(e))}),!t.results.length&&r.append('<tr><td class="empty" colspan=5>This folder is empty</td></tr>'),t.is_writable?$("body").removeClass("no_write"):$("body").addClass("no_write")):console.warn(t.error.msg),$("#table").retablesort()},"json")}function c(t){for(var e=0;1e3<=t;e++,t/=1024);var a=Math.round(10*t);return e?[parseInt(a/10),".",a%10," ",["bytes","KB","MB","GB","TB","PB","EB"][e]].join(""):t+" bytes"}var h=(document.cookie.match("(^|; )_sfm_xsrf=([^;]*)")||0)[2],u=134217728,r=$("#list");$(window).on("hashchange",l).trigger("hashchange"),$("#table").tablesorter(),$("#table").on("click",".delete",function(){return $.post("",{do:"delete",file:$(this).attr("data-file"),xsrf:h},function(){l()},"json"),!1}),$("#mkdir").submit(function(t){var e=decodeURIComponent(window.location.hash.substr(1)),a=$(this).find("[name=name]");return t.preventDefault(),a.val().length&&$.post("?",{do:"mkdir",name:a.val(),xsrf:h,file:e},function(){l()},"json"),a.val(""),!1}),// file upload stuff
$("#file_drop_target").on("dragover",function(){return $(this).addClass("drag_over"),!1}).on("dragend",function(){return $(this).removeClass("drag_over"),!1}).on("drop",function(t){t.preventDefault();var e=t.originalEvent.dataTransfer.files;$.each(e,function(t,e){a(e)}),$(this).removeClass("drag_over")}),$("input[type=file]").change(function(t){t.preventDefault(),$.each(this.files,function(t,e){a(e)})})});
//# sourceMappingURL=main.js.map