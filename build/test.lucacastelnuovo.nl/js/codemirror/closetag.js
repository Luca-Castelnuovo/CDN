"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(b){function r(e,t){for(var n=e.listSelections(),o=[],r=t?"/":"</",i=e.getOption("autoCloseTags"),a="object"==_typeof(i)&&i.dontIndentOnSlash,s=0;s<n.length;s++){if(!n[s].empty())return b.Pass;var l,f=n[s].head,d=e.getTokenAt(f),c=b.innerMode(e.getMode(),d.state),u=c.state;if(t&&("string"==d.type||"<"!=d.string.charAt(0)||d.start!=f.ch-1))return b.Pass;if("xml"!=c.mode.name)if("htmlmixed"==e.getMode().name&&"javascript"==c.mode.name)l=r+"script";else{if("htmlmixed"!=e.getMode().name||"css"!=c.mode.name)return b.Pass;l=r+"style"}else{if(!u.context||!u.context.tagName||x(e,u.context.tagName,f,u))return b.Pass;l=r+u.context.tagName}">"!=e.getLine(f.line).charAt(d.end)&&(l+=">"),o[s]=l}if(e.replaceSelections(o),n=e.listSelections(),!a)for(s=0;s<n.length;s++)(s==n.length-1||n[s].head.line<n[s+1].head.line)&&e.indentLine(n[s].head.line)}function v(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function x(e,t,n,o,r){if(!b.scanForClosingTag)return!1;var i=Math.min(e.lastLine()+1,n.line+500),a=b.scanForClosingTag(e,n,null,i);if(!a||a.tag!=t)return!1;for(var s=o.context,l=r?1:0;s&&s.tagName==t;s=s.prev)++l;n=a.to;for(var f=1;f<l;f++){var d=b.scanForClosingTag(e,n,null,i);if(!d||d.tag!=t)return!1;n=d.to}return!0}b.defineOption("autoCloseTags",!1,function(e,t,n){if(n!=b.Init&&n&&e.removeKeyMap("autoCloseTags"),t){var o={name:"autoCloseTags"};("object"!=_typeof(t)||t.whenClosing)&&(o["'/'"]=function(e){return(t=e).getOption("disableInput")?b.Pass:r(t,!0);var t}),("object"!=_typeof(t)||t.whenOpening)&&(o["'>'"]=function(e){return function(e){if(e.getOption("disableInput"))return b.Pass;for(var t=e.listSelections(),n=[],o=e.getOption("autoCloseTags"),r=0;r<t.length;r++){if(!t[r].empty())return b.Pass;var i=t[r].head,a=e.getTokenAt(i),s=b.innerMode(e.getMode(),a.state),l=s.state;if("xml"!=s.mode.name||!l.tagName)return b.Pass;var f="html"==s.mode.configuration,d="object"==_typeof(o)&&o.dontCloseTags||f&&P,c="object"==_typeof(o)&&o.indentTags||f&&T,u=l.tagName;a.end>i.ch&&(u=u.slice(0,u.length-a.end+i.ch));var g=u.toLowerCase();if(!u||"string"==a.type&&(a.end!=i.ch||!/[\"\']/.test(a.string.charAt(a.string.length-1))||1==a.string.length)||"tag"==a.type&&"closeTag"==l.type||a.string.indexOf("/")==a.string.length-1||d&&-1<v(d,g)||x(e,u,i,l,!0))return b.Pass;var m=c&&-1<v(c,g);n[r]={indent:m,text:">"+(m?"\n\n":"")+"</"+u+">",newPos:m?b.Pos(i.line+1,0):b.Pos(i.line,i.ch+1)}}var p="object"==_typeof(o)&&o.dontIndentOnAutoClose;for(r=t.length-1;0<=r;r--){var h=n[r];e.replaceRange(h.text,t[r].head,t[r].anchor,"+insert");var y=e.listSelections().slice(0);y[r]={head:h.newPos,anchor:h.newPos},e.setSelections(y),!p&&h.indent&&(e.indentLine(h.newPos.line,null,!0),e.indentLine(h.newPos.line+1,null,!0))}}(e)}),e.addKeyMap(o)}});var P=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],T=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];b.commands.closeTag=function(e){return r(e)}});
//# sourceMappingURL=closetag.js.map